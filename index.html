<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduShare - Study Material Viewer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6a11cb',
                        secondary: '#2575fc',
                        dark: '#2c3e50',
                        light: '#f8f9fa',
                    },
                    animation: {
                        'spin-slow': 'spin 1.5s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PDF.js library for rendering PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style type="text/css">
        .gradient-bg {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        }
        .gradient-text {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .navbar-blur {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        .dark .navbar-blur {
            background: rgba(26, 26, 46, 0.9);
        }
        .mobile-menu {
            transition: all 0.3s ease;
        }
        .nav-link {
            position: relative;
            padding: 0.5rem 0;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .hamburger-line {
            transition: all 0.3s ease;
        }
        .hamburger-active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        .hamburger-active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        .hamburger-active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        .card-hover {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .play-btn-hover {
            transition: opacity 0.3s;
        }
        .video-preview:hover .play-btn-hover {
            opacity: 1;
        }
        .share-btn-hover {
            transition: transform 0.3s;
        }
        .share-btn-hover:hover {
            transform: scale(1.1);
        }
        /* Custom scrollbar for modal */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c5c5c5;
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4a5568;
        }
        /* PDF.js viewer customization */
        .pdf-page {
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .pdf-page canvas {
            display: block;
            margin: 0 auto;
        }
        /* Animation for resource cards */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-300">
    <!-- Modern Navigation Bar -->
    <nav class="navbar-blur fixed top-0 left-0 right-0 z-50 shadow-md py-3 px-4 md:px-6">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center">
                <i class="fas fa-graduation-cap text-primary text-2xl mr-3"></i>
                <span class="font-bold text-2xl gradient-text">EduShare</span>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" class="nav-link font-medium text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Home</a>
                <a href="#" class="nav-link font-medium text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Materials</a>
                <a href="#" class="nav-link font-medium text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">About</a>
                <a href="#" class="nav-link font-medium text-gray-700 dark:text-gray-300 hover:text-primary transition-colors">Contact</a>
            </div>

            <!-- Right side actions -->
            <div class="flex items-center space-x-4">
                <!-- Theme Toggle -->
                <button id="themeToggle" class="w-10 h-10 rounded-full border border-gray-300 dark:border-gray-600 flex items-center justify-center text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-moon"></i>
                </button>

                <!-- Telegram Button -->
                <a href="https://t.me/paid_promo0x" target="_blank" class="hidden md:flex gradient-bg text-white py-2 px-4 rounded-full font-semibold items-center space-x-2 hover:shadow-lg transition-all">
                    <i class="fab fa-telegram"></i>
                    <span>Report Bug</span>
                </a>

                <!-- Mobile menu button -->
                <button id="mobileMenuButton" class="md:hidden flex flex-col space-y-1.5 w-8 h-8 justify-center items-center">
                    <span class="hamburger-line block w-6 h-0.5 bg-gray-700 dark:bg-gray-300 rounded">home</span>
                    <span class="hamburger-line block w-6 h-0.5 bg-gray-700 dark:bg-gray-300 rounded"></span>
                    <span class="hamburger-line block w-6 h-0.5 bg-gray-700 dark:bg-gray-300 rounded"></span>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="mobile-menu md:hidden absolute top-full left-0 right-0 bg-white dark:bg-gray-800 shadow-lg rounded-b-lg overflow-hidden transform -translate-y-full opacity-0">
            <div class="flex flex-col py-3">
                <a href="#" class="px-6 py-3 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                    <i class="fas fa-home mr-3 text-primary"></i>Home
                </a>
                <a href="#" class="px-6 py-3 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                    <i class="fas fa-book mr-3 text-primary"></i>Materials
                </a>
                <a href="#" class="px-6 py-3 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                    <i class="fas fa-info-circle mr-3 text-primary"></i>About
                </a>
                <a href="#" class="px-6 py-3 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                    <i class="fas fa-envelope mr-3 text-primary"></i>Contact
                </a>
                <a href="https://t.me/paid_promo0x" target="_blank" class="px-6 py-3 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center">
                    <i class="fab fa-telegram mr-3 text-primary"></i>Report Bug
                </a>
            </div>
        </div>
    </nav>

    <!-- Content with padding for fixed navbar -->
    <div class="pt-20 pb-10 px-4 md:px-6">
        <div class="max-w-6xl mx-auto">
            <header class="text-center py-8">
                <h1 class="text-3xl md:text-4xl font-bold gradient-text mb-4">Study Material Viewer</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                    Upload your study materials and access them in an organized way with a modern interface
                </p>
            </header>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Upload Section -->
                <section id="uploadSection" class="w-full lg:w-1/3 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transition-opacity">
                    <h2 class="text-2xl font-bold text-primary mb-6 pb-3 border-b border-gray-200 dark:border-gray-700">Upload Your Study Material</h2>
                    
                    <div class="bg-amber-100 dark:bg-amber-900/30 border-l-4 border-amber-500 rounded px-4 py-3 mb-6 flex items-start space-x-3">
                        <i class="fas fa-shield-alt text-amber-500 text-xl mt-1"></i>
                        <div>
                            <h4 class="font-bold text-amber-800 dark:text-amber-200">Security Notice</h4>
                            <p class="text-amber-700 dark:text-amber-300 text-sm">Only .txt files are allowed. All uploads are scanned for security.</p>
                        </div>
                    </div>
                    
                    <div id="uploadArea" class="border-2 border-dashed border-primary rounded-xl py-10 px-6 text-center cursor-pointer transition-colors hover:bg-purple-50 dark:hover:bg-purple-900/20 mb-6">
                        <i class="fas fa-file-upload text-primary text-4xl mb-4"></i>
                        <h3 class="text-primary font-semibold text-xl mb-2">Click to upload a text file</h3>
                        <p class="text-gray-600 dark:text-gray-400">Supported format: .txt files with video and PDF links</p>
                        <input type="file" id="fileInput" accept=".txt" class="hidden">
                    </div>
                    <button id="uploadBtn" class="gradient-bg text-white w-full py-3 px-6 rounded-full font-semibold flex items-center justify-center space-x-2 shadow-md hover:shadow-lg transition-all">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Upload File</span>
                    </button>
                </section>

                <!-- Content Section -->
                <section id="contentSection" class="w-full lg:w-2/3 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hidden">
                    <div class="gradient-bg text-white rounded-lg p-4 mb-6 flex flex-col sm:flex-row justify-between items-center">
                        <h2 class="text-2xl font-bold mb-3 sm:mb-0">Your Study Materials</h2>
                        <div id="resourcesCount" class="bg-white/20 py-1 px-3 rounded-full text-sm">0 Videos, 0 PDFs</div>
                    </div>

                    <div class="mb-6">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input type="text" id="searchInput" class="flex-grow px-5 py-3 rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Search by title...">
                            <button id="searchBtn" class="gradient-bg text-white py-3 px-6 rounded-full font-semibold flex items-center justify-center space-x-2">
                                <i class="fas fa-search"></i>
                                <span class="hidden sm:inline">Search</span>
                            </button>
                        </div>
                        <div id="searchResults" class="text-sm text-gray-600 dark:text-gray-400 mt-2 pl-5">Showing all resources</div>
                    </div>
                    
                    <div id="videoContainer" class="space-y-6 mb-8">
                        <!-- Content will be generated here -->
                    </div>

                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl p-5 text-center">
                        <h3 class="text-xl font-semibold mb-2">Share these resources with your friends</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Help others benefit from these study materials</p>
                        <div class="flex justify-center space-x-4">
                            <a href="#" id="whatsappShare" class="share-btn-hover w-12 h-12 rounded-full bg-green-500 flex items-center justify-center text-white text-xl">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            <a href="#" id="telegramShare" class="share-btn-hover w-12 h-12 rounded-full bg-blue-400 flex items-center justify-center text-white text-xl">
                                <i class="fab fa-telegram"></i>
                            </a>
                            <a href="#" id="facebookShare" class="share-btn-hover w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center text-white text-xl">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" id="twitterShare" class="share-btn-hover w-12 h-12 rounded-full bg-blue-400 flex items-center justify-center text-white text-xl">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- PDF Viewer Modal -->
    <div id="pdfModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden overflow-auto custom-scrollbar">
        <div class="bg-white dark:bg-gray-800 rounded-xl mx-auto my-8 p-6 max-w-4xl w-11/12 max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center pb-4 mb-4 border-b border-gray-200 dark:border-gray-700">
                <h2 id="pdfModalTitle" class="text-2xl font-bold text-primary">PDF Document</h2>
                <button id="closePdfModal" class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="pdfViewerContainer" class="flex-grow overflow-auto">
                <div class="flex justify-center space-x-4 mb-4 py-2 bg-gray-100 dark:bg-gray-700 rounded">
                    <button id="prevPage" class="px-4 py-2 bg-primary text-white rounded flex items-center space-x-2">
                        <i class="fas fa-arrow-left"></i>
                        <span>Previous</span>
                    </button>
                    <span id="pageInfo" class="px-4 py-2">Page 1 of 1</span>
                    <button id="nextPage" class="px-4 py-2 bg-primary text-white rounded flex items-center space-x-2">
                        <span>Next</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div id="pdfViewer" class="pdf-viewer-container">
                    <!-- PDF will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-4">Study Material Viewer &copy; 2025 | Designed with ❤️ for Students</p>
            <div class="flex justify-center space-x-6">
                <a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">Privacy Policy</a>
                <a href="#" class="text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">Terms of Service</a>
                <a href="https://t.me/paid_promo0x" target="_blank" class="text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">Telegram Support</a>
            </div>
        </div>
    </footer>

    <script>
        // Set the PDF.js worker path
        pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const uploadSection = document.getElementById('uploadSection');
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const contentSection = document.getElementById('contentSection');
            const videoContainer = document.getElementById('videoContainer');
            const resourcesCount = document.getElementById('resourcesCount');
            const themeToggle = document.getElementById('themeToggle');
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            const shareButtons = document.querySelectorAll('.share-btn-hover');
            const pdfModal = document.getElementById('pdfModal');
            const pdfModalTitle = document.getElementById('pdfModalTitle');
            const closePdfModal = document.getElementById('closePdfModal');
            const pdfViewerContainer = document.getElementById('pdfViewer');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const searchResults = document.getElementById('searchResults');
            
            // PDF viewing variables
            let currentPdf = null;
            let currentPageNum = 1;
            let totalPages = 1;
            
            // Current resources for sharing and searching
            let currentResources = [];
            let videoCount = 0;
            let pdfCount = 0;
            
            // Initialize theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Handle theme toggle
            themeToggle.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark');
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.setItem('theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    localStorage.setItem('theme', 'light');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            });

            // Mobile menu functionality
            mobileMenuButton.addEventListener('click', function() {
                mobileMenuButton.classList.toggle('hamburger-active');
                if (mobileMenu.classList.contains('opacity-0')) {
                    mobileMenu.classList.remove('transform', '-translate-y-full', 'opacity-0');
                    mobileMenu.classList.add('animate-slide-down');
                } else {
                    mobileMenu.classList.add('transform', '-translate-y-full', 'opacity-0');
                    mobileMenu.classList.remove('animate-slide-down');
                }
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target) && !mobileMenu.classList.contains('opacity-0')) {
                    mobileMenu.classList.add('transform', '-translate-y-full', 'opacity-0');
                    mobileMenu.classList.remove('animate-slide-down');
                    mobileMenuButton.classList.remove('hamburger-active');
                }
            });

            // Close mobile menu when clicking on a link
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenu.classList.add('transform', '-translate-y-full', 'opacity-0');
                    mobileMenu.classList.remove('animate-slide-down');
                    mobileMenuButton.classList.remove('hamburger-active');
                });
            });

            // Handle upload area click
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });

            // Handle upload button click
            uploadBtn.addEventListener('click', function() {
                fileInput.click();
            });

            // Handle file selection
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    
                    // Check if file is text
                    if (file.type === 'text/plain') {
                        // Show loading state
                        uploadBtn.innerHTML = '<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin-slow mr-2"></div> Processing...';
                        uploadBtn.disabled = true;
                        
                        setTimeout(() => {
                            const reader = new FileReader();
                            
                            reader.onload = function(e) {
                                const content = e.target.result;
                                processFileContent(content, file.name);
                                uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Upload File';
                                uploadBtn.disabled = false;
                            };
                            
                            reader.readAsText(file);
                        }, 500);
                    } else {
                        alert('Please upload a text file (.txt) only. Other file types are not supported for security reasons.');
                        fileInput.value = '';
                    }
                }
            });

            // Process the uploaded file content
            function processFileContent(content, fileName) {
                // Clear previous content
                videoContainer.innerHTML = '';
                currentResources = [];
                videoCount = 0;
                pdfCount = 0;
                
                // Split content by lines
                const lines = content.split('\n').filter(line => line.trim() !== '');
                
                // Process each line
                lines.forEach((line, index) => {
                    // Extract title and URL
                    const parts = line.split(': ');
                    if (parts.length >= 2) {
                        const title = parts[0];
                        const url = parts.slice(1).join(': '); // In case URL contains ":"
                        
                        // Determine type from URL
                        let type = 'other';
                        if (url.includes('.mp4')) {
                            type = 'video';
                            videoCount++;
                        } else if (url.includes('.pdf')) {
                            type = 'pdf';
                            pdfCount++;
                        }
                        
                        // Store resource for sharing
                        currentResources.push({ title, url, type, element: null });
                        
                        // Create resource card with delay for staggered loading
                        setTimeout(() => {
                            createResourceCard(title, url, type, index);
                        }, index * 100);
                    }
                });
                
                if (currentResources.length > 0) {
                    // Update resources count
                    resourcesCount.textContent = `${videoCount} Videos, ${pdfCount} PDFs`;
                    searchResults.textContent = `Showing all ${currentResources.length} resources`;
                    
                    // Show content section and hide upload section
                    contentSection.classList.remove('hidden');
                    uploadSection.classList.add('opacity-50');
                    uploadSection.style.pointerEvents = 'none';
                    
                    // Set up sharing
                    setupSharing(fileName);
                    
                    // Scroll to content section
                    contentSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    alert('No valid resources found in the file. Please check the format.');
                }
            }

            // Create resource card element
            function createResourceCard(title, url, type, index) {
                const resourceCard = document.createElement('div');
                resourceCard.className = 'bg-white dark:bg-gray-700 rounded-xl shadow-md card-hover overflow-hidden opacity-0 animate-fade-in-up';
                resourceCard.dataset.index = index;
                resourceCard.dataset.title = title.toLowerCase();
                
                resourceCard.innerHTML = `
                    <div class="gradient-bg text-white p-4 flex justify-between items-center">
                        <h3 class="font-semibold text-lg truncate">${title}</h3>
                        <span class="bg-white/20 py-1 px-3 rounded-full text-xs font-medium">${type.toUpperCase()}</span>
                    </div>
                `;
                
                if (type === 'video') {
                    // Create a preview for video with play button
                    resourceCard.innerHTML += `
                        <div class="video-preview relative h-48 bg-black cursor-pointer overflow-hidden" data-url="${url}" data-title="${title}">
                            <img src="https://static.vecteezy.com/system/resources/thumbnails/028/259/750/small_2x/play-icon-red-buttons-sign-on-white-background-motion-graphics-video.jpg" alt="${title}" class="w-full h-full object-cover transition-transform duration-300">
                            <div class="play-btn-hover absolute inset-0 flex items-center justify-center opacity-80">
                                <i class="fas fa-play-circle text-white text-5xl"></i>
                            </div>
                        </div>
                    `;
                } else if (type === 'pdf') {
                    // Create a preview for PDF
                    resourceCard.innerHTML += `
                        <div class="pdf-preview h-48 bg-gray-100 dark:bg-gray-600 flex flex-col items-center justify-center cursor-pointer" data-url="${url}" data-title="${title}">
                            <i class="fas fa-file-pdf text-primary text-6xl mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-300">Click to view PDF</p>
                        </div>
                    `;
                } else {
                    resourceCard.innerHTML += `
                        <div class="p-4">
                            <p class="text-gray-600 dark:text-gray-300">This resource type is not directly viewable. <a href="${url}" target="_blank" class="text-primary font-medium">Open resource</a></p>
                        </div>
                    `;
                }
                
                resourceCard.innerHTML += `
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2 truncate">${title}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm">${type.toUpperCase()} Resource • ${new Date().toLocaleDateString()}</p>
                    </div>
                `;
                
                videoContainer.appendChild(resourceCard);
                
                // Store reference to the element
                currentResources[index].element = resourceCard;
                
                // Add click handlers for previews
                if (type === 'video') {
                    const previewEl = resourceCard.querySelector('[data-url]');
                    previewEl.addEventListener('click', function() {
                        openVideo(this.dataset.url, this.dataset.title);
                    });
                } else if (type === 'pdf') {
                    const previewEl = resourceCard.querySelector('[data-url]');
                    previewEl.addEventListener('click', function() {
                        openPdf(this.dataset.url, this.dataset.title);
                    });
                }
            }
            
            // Open video in new tab
            function openVideo(url, title) {
                window.open(url, '_blank');
            }
            
            // Open PDF in modal
            function openPdf(url, title) {
                pdfModalTitle.textContent = title;
                pdfModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // Load the PDF
                loadPdf(url);
            }
            
            // Load PDF using PDF.js
            function loadPdf(url) {
                // Show loading state
                pdfViewerContainer.innerHTML = '<div class="text-center py-20">Loading PDF...</div>';
                
                // Reset page variables
                currentPageNum = 1;
                
                // Load the PDF
                const loadingTask = pdfjsLib.getDocument(url);
                loadingTask.promise.then(function(pdf) {
                    currentPdf = pdf;
                    totalPages = pdf.numPages;
                    pageInfo.textContent = `Page ${currentPageNum} of ${totalPages}`;
                    
                    // Render the first page
                    renderPage(currentPageNum);
                }).catch(function(error) {
                    console.error('Error loading PDF:', error);
                    pdfViewerContainer.innerHTML = `
                        <div class="text-center py-20">
                            <p class="mb-4">Error loading PDF. Please try again or <a href="${url}" target="_blank" class="text-primary font-medium">open in new tab</a>.</p>
                        </div>
                    `;
                });
            }
            
            // Render a specific page
            function renderPage(pageNum) {
                currentPdf.getPage(pageNum).then(function(page) {
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    // Prepare canvas for rendering
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    // Render PDF page
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    
                    const renderTask = page.render(renderContext);
                    
                    renderTask.promise.then(function() {
                        // Clear the container and add the canvas
                        pdfViewerContainer.innerHTML = '';
                        pdfViewerContainer.appendChild(canvas);
                        
                        // Add page controls
                        const controls = document.createElement('div');
                        controls.className = 'flex justify-center space-x-4 mb-4 py-2 bg-gray-100 dark:bg-gray-700 rounded';
                        controls.innerHTML = `
                            <button id="prevPage" class="px-4 py-2 bg-primary text-white rounded flex items-center space-x-2">
                                <i class="fas fa-arrow-left"></i>
                                <span>Previous</span>
                            </button>
                            <span id="pageInfo" class="px-4 py-2">Page ${currentPageNum} of ${totalPages}</span>
                            <button id="nextPage" class="px-4 py-2 bg-primary text-white rounded flex items-center space-x-2">
                                <span>Next</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        `;
                        pdfViewerContainer.appendChild(controls);
                        
                        // Add event listeners for page navigation
                        document.getElementById('prevPage').addEventListener('click', function() {
                            if (currentPageNum > 1) {
                                currentPageNum--;
                                renderPage(currentPageNum);
                            }
                        });
                        
                        document.getElementById('nextPage').addEventListener('click', function() {
                            if (currentPageNum < totalPages) {
                                currentPageNum++;
                                renderPage(currentPageNum);
                            }
                        });
                    });
                });
            }
            
            // Close PDF modal
            closePdfModal.addEventListener('click', function() {
                pdfModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === pdfModal) {
                    pdfModal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            });

            // Search functionality
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            function performSearch() {
                const searchTerm = searchInput.value.trim().toLowerCase();
                let visibleCount = 0;
                
                if (searchTerm === '') {
                    // Show all resources if search is empty
                    currentResources.forEach(resource => {
                        if (resource.element) {
                            resource.element.classList.remove('hidden');
                            visibleCount++;
                        }
                    });
                    searchResults.textContent = `Showing all ${visibleCount} resources`;
                } else {
                    // Filter resources based on search term
                    currentResources.forEach(resource => {
                        if (resource.element) {
                            if (resource.title.toLowerCase().includes(searchTerm)) {
                                resource.element.classList.remove('hidden');
                                visibleCount++;
                            } else {
                                resource.element.classList.add('hidden');
                            }
                        }
                    });
                    searchResults.textContent = `Found ${visibleCount} resources matching "${searchTerm}"`;
                }
                
                // Show no results message if no resources match
                const noResultsElement = document.getElementById('noResultsMessage');
                if (visibleCount === 0) {
                    if (!noResultsElement) {
                        const noResults = document.createElement('div');
                        noResults.id = 'noResultsMessage';
                        noResults.className = 'text-center py-10 text-gray-500 dark:text-gray-400';
                        noResults.innerHTML = `
                            <i class="fas fa-search text-5xl text-primary mb-4"></i>
                            <h3 class="text-xl font-semibold mb-2">No resources found</h3>
                            <p>Try different search terms or upload a new file</p>
                        `;
                        videoContainer.appendChild(noResults);
                    }
                } else if (noResultsElement) {
                    noResultsElement.remove();
                }
            }

            // Set up sharing buttons
            function setupSharing(fileName) {
                const shareText = `Check out these study materials from ${fileName}`;
                const shareUrl = encodeURIComponent(window.location.href);
                const fullText = encodeURIComponent(`${shareText} - ${shareUrl}`);
                
                document.getElementById('whatsappShare').href = `https://wa.me/?text=${fullText}`;
                document.getElementById('telegramShare').href = `https://t.me/share/url?url=${shareUrl}&text=${shareText}`;
                document.getElementById('facebookShare').href = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
                document.getElementById('twitterShare').href = `https://twitter.com/intent/tweet?text=${fullText}`;
            }

            // Set up share buttons
            document.querySelectorAll('.share-btn-hover').forEach(button => {
                button.addEventListener('click', function(e) {
                    if (currentResources.length === 0) {
                        e.preventDefault();
                        alert('Please upload a file with resources first.');
                    }
                });
            });
        });
    </script>
</body>
</html>
